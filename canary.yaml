# The name of the deployed application.
application: <App Name>
# The name of an agent configured account.
account: <Account>
# The Kubernetes namespace where the provided manifests will be deployed.
namespace: <Namespace>
# The list of manifests sources.
manifests:
    - inline: # This map key, is the manifest source type.
        # A YAML-encoded string containing a Kubernetes resource manifest.
        value: '| apiVersion: apps/v1...'
canary: # This map key, is the deployment strategy type.
    # A list of progressive canary steps.
    steps:
        - pause: # The map key is the step type
            # The duration of the pause. If duration is non-zero, untilApproved should be set to false.
            duration: 1
            unit: SECONDS
        - setweight:
            # The percent of pods that should be running the canary version. Weight should be between 0 and 100 inclusive.
            weight: 33
        - pause:
            # If set to true, the progressive canary will wait until a manual judgment to continue. This field should not be set to true unless duration and unit are unset.
            untilapproved: true

--------------------------------------

version: v1
kind: kubernetes
application: potato-facts
# Map of Deployment Targets, this is set up in a way where
# we can do multi-target deployments (multi-region or multi-cluster)
targets:
    # This in the name of a deployment, underneath it are its configuration
    dev-west:
        # the name of an agent configured account
        account: armory-cloud-hosted-services
        # Optionally override the namespaces that are in the manifests
        namespace: hosted-services-dev
        # This is the key to a strategy under the strategies map
        strategy: strategy1
        # This is a list of manifest names that should be included in this deployment
# The list of manifests sources
manifests:
    # This will read all yaml|yml files in a dir and deploy all manifests in that directory to all targets.
    - path: infrastructure/manifests/configmaps
    # This specifies a specific manifest file
    - path: infrastructure/manifests/deployment.yaml
# The map of strategies, a deployment target will reference one of these
strategies:
    # this is the name for the strategy
    strategy1:
        # This map key, is the deployment strategy type
        - canary:
              # List of canary steps
              steps:
                  # The map key is the step type
                  - setWeight:
                        weight: 33
                  - pause:
                        duration: 1
                        unit: seconds
                  - setweight:
                        weight: 66
                  - pause:
                        untilApproved: true