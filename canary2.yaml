version: v1
kind: kubernetes
# The name of the deployed application.
application: <App Name>
targets: # Map of Deployment Targets, Map of deployment targets. You can specify more than one target, but we currently only support deploying to one. Specifying more than one target will be available in a future feature.
    dev-west: # Specify a deployment target. The identifier for a deployment target is its name.
        # The name of an agent configured account
        account: account-name
        # Optionally override the namespaces that are in the manifests
        namespace: namespace
        # This is the key to a strategy specified in the strategies map below
        strategy: strategy1
# The list of manifest sources.
manifests:
    - # This will read all yaml|yml files in a dir and deploy all manifests in that directory to all targets.
      path: infrastructure/manifests/configmaps
    - # This will read all yaml|yml files in a dir and deploy all manifests in that directory to all targets.
      path: infrastructure/manifests/deployment.yaml
strategies: # A map of strategies, each of which can be assigned to deployment targets in the targets map.
    strategy1: # Specify a strategy. The identifier for a strategy is its name.
        canary: # This map key, is the deployment strategy type.
            # A list of progressive canary steps.
            steps:
                - pause: # The map key is the step type
                    # The duration of the pause before the deployment continues. If duration is not zero, set untilApproved to false.
                    duration: 1
                    unit: SECONDS
                - setWeight:
                    # The percentage of pods that should be running the canary version for this step. Set it to an integer between 0 and 100, inclusive.
                    weight: 33
                - pause:
                    # If set to true, the deployment waits until a manual approval to continue. Only set this to true if duration and unit are not set.
                    untilApproved: true
